
<!DOCTYPE html>
<html>
<head>
    <title>Lunch Locations Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        .info-panel {
            position: absolute;
            top: 60px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 250px;
        }
        .travel-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }
        .selection-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 250px;
        }
        .popup-image-gallery {
            margin-top: 10px;
            max-width: 300px;
        }
        .popup-image-gallery img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 8px;
            display: none;
            cursor: pointer;
        }
        .popup-image-gallery img.active {
            display: block;
        }
        .popup-gallery-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }
        .popup-nav-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .popup-nav-btn:hover {
            background: #45a049;
        }
        .popup-counter {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="info-panel">
        <h3>Lunch Locations Map</h3>
        <p><span style="color: green;">●</span> Visited locations</p>
        <p><span style="color: blue;">●</span> All other places</p>
        <p><span style="color: red;">●</span> University of Antwerp</p>
    </div>
    
    <div class="selection-panel">
        <p><strong>Click two markers to see travel time</strong></p>
        <button onclick="clearSelection()">Clear Selection</button>
    </div>
    
    <div class="travel-info" id="travelInfo">
        <h4>Travel Information</h4>
        <div id="travelDetails"></div>
    </div>

    <script>
        // Initialize map
        const map = L.map('map').setView([51.2054, 4.4132], 13); // Center on Antwerp
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);
        
        // Location data
        const locations = [{"name": "Munji", "address": "Oude Koornmarkt 68, 2000 Antwerpen", "cuisine": "Middle Eastern", "price_range": "$", "note": "Very tasty falafel wrap. Place is small and only has around 8 seats, place outside on a terrace. There were heating lamps. A bit pricey for a wrap at 9.5\u20ac", "pics": "images/munji", "coordinates": [51.218929, 4.4002575], "images": ["images/munji/closedFalafel.jpg", "images/munji/openFalafel.jpg"], "visited": true}, {"name": "Tjoung Tjoung", "address": "Breydelstraat 16, 2018 Antwerpen", "cuisine": "Thai", "price_range": "$$", "note": "More of a sit down restaurant (heavier, real meal), but casual. Prices for dishes are 12-18 EUR depending on what you get. Here, you the [menu](https://de.cdn-website.com/3353011bf29947999eff0661ce2f3bfa/DESKTOP/pdf/menu.pdf).", "pics": "images/tjoung", "coordinates": [51.2186649, 4.4191256], "images": ["images/tjoung/food1.jpg", "images/tjoung/food2.jpg"], "visited": false}, {"name": "Koffie Dealers", "address": "Paardenmarkt 117, 2000 Antwerpen", "cuisine": "Greek, European", "price_range": "$", "note": "Coffee shop (coffee itself is good here), it has savory pastries too, with feta cheese and spinach so it can be a smaller lunch too. It can be busy at times.", "pics": "images/koffieDealers", "coordinates": [51.2247986, 4.4141247], "images": ["images/koffieDealers/food.jpg"], "visited": false}, {"name": "Phiin C\u00e0 Ph\u00ea", "address": "Vlasmarkt 22, 2000 Antwerpen", "cuisine": "Viet", "price_range": "$", "note": "Viet coffee place. It has spring rolls and bahn mi too. Smaller place, few seats inside. Here is the [menu](https://orderbilly.com/events/4edb66aa-b43c-477d-8ba7-221ad4961db0).", "pics": "images/phiin", "coordinates": [51.2196747, 4.3973521], "images": ["images/phiin/banhmi.jpg", "images/phiin/drinks.jpg", "images/phiin/springrolls.jpg"], "visited": false}, {"name": "Arepa culture Antwerpen \ud83c\uddfb\ud83c\uddea", "address": "Sint-Katelijnevest 46, 2000 Antwerpen", "cuisine": "Venezuelan", "price_range": "$$", "note": "Arepas (corn based pastry with savory ingredients inside, like beef, guacamole etc.) A bit pricey now, for what you get (might be small). It was tasty last time I went.", "pics": "images/arepa", "coordinates": [51.2196254, 4.4050927], "images": ["images/arepa/arepas.jpg", "images/arepa/menu.jpg"], "visited": false}, {"name": "Afghan Darbar Restaurant", "address": "Sint-Gummarusstraat 35, 2060 Antwerpen", "cuisine": "Afghan", "price_range": "$$", "note": "Large restaurant, also sit-down type. Prices are not so high, 10-15 EUR approximatley. Has many options and has a lot of room.", "pics": "images/darbar", "coordinates": [51.2248866, 4.4206542], "images": ["images/darbar/options1.jpg", "images/darbar/options2.jpg"], "visited": false}, {"name": "Ovanos", "address": "Lange Zavelstraat 40, 2060 Antwerpen", "cuisine": "Morrocan", "price_range": "$", "note": "Morrocan breakfast and lunch place, not so expensive. Just a bit more far from the university. Here is the [menu](https://ovanos.be/menu/)", "pics": "images/ovanos", "coordinates": [51.2233783, 4.4272309], "images": ["images/ovanos/food.jpg", "images/ovanos/meals.jpg"], "visited": false}, {"name": "Ellis Gourmet Burger Eilandje", "address": "Sint-Aldegondiskaai 52, 2000 Antwerpen", "cuisine": "American (?)", "price_range": "$$", "note": "\"Gourmet\" burger place. Lunch menu and student menu at 12.5 EUR, no drinks included. Other options more expensive.", "pics": "images/ellis", "coordinates": [51.2278101, 4.4045772], "images": ["images/ellis/burger.jpg"], "visited": false}, {"name": "Aydo", "address": "Kammenstraat 10, 2000 Antwerpen", "cuisine": "Lebanese", "price_range": "$", "note": "Lebanese wraps, limited seating space.", "pics": "images/aydo", "coordinates": [51.218663, 4.3999346], "images": ["images/aydo/menu.jpg", "images/aydo/wraps.jpg", "images/aydo/wrapsdone.jpg"], "visited": false}, {"name": "Souvlakeri", "address": "Grote Markt 35, 2000 Antwerpen", "cuisine": "Greek", "price_range": "$", "note": "Greek wraps. Here is the [menu](https://www.souvlakeri.be/Menu-Restaurant).", "pics": "images/souvla", "coordinates": [51.221272, 4.401539], "images": ["images/souvla/wrap.jpg"], "visited": false}, {"name": "Banh Mi Antwerp", "address": "Korte Koepoortstraat 8, 2000 Antwerpen", "cuisine": "Viet", "price_range": "$-$$", "note": "Vietnamese sandwhiches. [Menu](https://banhmiantwerp.be/en/menu/5101513665207599213)", "pics": "images/bahnMi", "coordinates": [51.221266, 4.4023741], "images": ["images/bahnMi/noodles.jpg", "images/bahnMi/sandwhich.jpg"], "visited": false}, {"name": "Lhasa Wok", "address": "Jezusstraat 35, 2000 Antwerpen", "cuisine": "\"Asian\"", "price_range": "$", "note": "Wok place, most likely for takeaway.", "pics": "images/lhasa", "coordinates": [51.2195475, 4.4142933], "images": ["images/lhasa/Untitled.jpg", "images/lhasa/menu.jpg"], "visited": false}, {"name": "Broodjeszaak Te Peca", "address": "Sint-Jacobsmarkt 62, 2000 Antwerpen", "cuisine": "Belgian", "price_range": "$", "note": "Sandwhich place, it has burgers too.", "pics": "images/peca", "coordinates": [51.2200702, 4.4131672], "images": ["images/peca/menu.jpg"], "visited": false}, {"name": "Mandarin", "address": "Statiestraat 18, 2018 Antwerpen", "cuisine": "Lebanese BBQ", "price_range": "$-$$", "note": "BBQ place, relatively cheap (9-12 EUR). It has falafel and kibbeh too (veggie).", "pics": "images/mandarin", "coordinates": [51.2180682, 4.4186503], "images": ["images/mandarin/food1.jpg", "images/mandarin/food2.jpg"], "visited": false}, {"name": "Snack omar", "address": "Sint-Jansplein 55, 2060 Antwerpen", "cuisine": "Iraq", "price_range": "$-$$", "note": "Iraqi place, cheap-ish 7-12 EUR.", "pics": "images/omar", "coordinates": [51.2252821, 4.4166285], "images": ["images/omar/bread.jpg", "images/omar/food1.jpg"], "visited": false}];
        
        // Selected markers for routing
        let selectedMarkers = [];
        let routingControl = null;
        
        // Create custom icons
        const visitedIcon = L.divIcon({
            html: '<div style="background: green; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
            iconSize: [16, 16],
            className: 'custom-marker'
        });
        
        const placeIcon = L.divIcon({
            html: '<div style="background: blue; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
            iconSize: [16, 16],
            className: 'custom-marker'
        });
        
        const universityIcon = L.divIcon({
            html: '<div style="background: red; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
            iconSize: [16, 16],
            className: 'custom-marker'
        });
        
        // Close pinned popups when clicking on the map (not on a marker)
        map.on('click', function() {
            closeAllPinnedPopups();
        });
        
        // Store gallery states for each marker
        const galleryStates = new Map();
        
        // Track pinned popups (clicked to stay open)
        const pinnedMarkers = new Set();
        let isHoveringPopup = false;
        
        // Function to convert markdown links to HTML
        function markdownLinksToHtml(text) {
            if (!text) return text;
            // Convert markdown links [text](url) to HTML <a> tags
            return text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
        }
        
        // Add markers
        locations.forEach(function(location) {
            const icon = location.visited ? visitedIcon : placeIcon;
            
            const marker = L.marker([location.coordinates[0], location.coordinates[1]], {icon: icon})
                .addTo(map);
            
            let popupContent = `<strong>${location.name}</strong><br>`;
            if (location.address) popupContent += `Address: ${location.address}<br>`;
            if (location.cuisine) popupContent += `Cuisine: ${location.cuisine}<br>`;
            if (location.price_range) popupContent += `Price: ${location.price_range}<br>`;
            if (location.visited) popupContent += `<span style="color: green;">✓ Visited</span><br>`;
            if (location.note) popupContent += `Note: ${markdownLinksToHtml(location.note)}`;
            
            // Add image gallery to popup if images exist
            if (location.images && location.images.length > 0) {
                const galleryId = 'gallery-' + location.name.replace(/[^a-zA-Z0-9]/g, '-');
                galleryStates.set(galleryId, 0); // Initialize at first image
                
                popupContent += `<div class="popup-image-gallery" id="${galleryId}">`;
                location.images.forEach((imgPath, index) => {
                    popupContent += `<img src="${imgPath}" class="${index === 0 ? 'active' : ''}" alt="Image ${index + 1}">`;
                });
                
                if (location.images.length > 1) {
                    popupContent += `<div class="popup-gallery-controls">`;
                    popupContent += `<button class="popup-nav-btn" onclick="navigatePopupGallery('${galleryId}', -1)">← Prev</button>`;
                    popupContent += `<span class="popup-counter" id="${galleryId}-counter">1 / ${location.images.length}</span>`;
                    popupContent += `<button class="popup-nav-btn" onclick="navigatePopupGallery('${galleryId}', 1)">Next →</button>`;
                    popupContent += `</div>`;
                }
                popupContent += `</div>`;
            }
            
            marker.bindPopup(popupContent, {
                closeOnClick: false,
                autoClose: false,
                closeButton: true
            });
            
            // Show popup on hover
            marker.on('mouseover', function() {
                marker.openPopup();
            });
            
            // Close popup when mouse leaves (with delay to check if moving to popup)
            marker.on('mouseout', function() {
                setTimeout(function() {
                    // Only close if not hovering popup and not pinned
                    if (!isHoveringPopup && !pinnedMarkers.has(marker)) {
                        marker.closePopup();
                    }
                }, 100);
            });
            
            // Pin popup on click (keep it open)
            marker.on('click', function(e) {
                pinnedMarkers.add(marker);
                marker.openPopup();
                handleMarkerClick(location, marker);
            });
            
            // Setup popup event listeners when popup opens
            marker.on('popupopen', function() {
                const popupElement = marker.getPopup().getElement();
                
                popupElement.addEventListener('mouseenter', function() {
                    isHoveringPopup = true;
                });
                
                popupElement.addEventListener('mouseleave', function() {
                    isHoveringPopup = false;
                    // Close popup if not pinned
                    if (!pinnedMarkers.has(marker)) {
                        marker.closePopup();
                    }
                });
                
                // Add double-click handler to images
                const images = popupElement.querySelectorAll('.popup-image-gallery img');
                images.forEach(function(img) {
                    img.addEventListener('dblclick', function() {
                        window.open(img.src, '_blank');
                    });
                });
            });
            
            // Unpin when popup closes
            marker.on('popupclose', function() {
                pinnedMarkers.delete(marker);
            });
        });
        
        // Add University of Antwerp Stadscampus marker
        const uaImages = ["images/UA/hof.jpg"];
        let uaPopupContent = '<strong>University of Antwerp - Stadscampus</strong><br>Prinsstraat 13, 2000 Antwerpen';
        
        // Add image gallery to UA popup if images exist
        if (uaImages && uaImages.length > 0) {
            const galleryId = 'gallery-UA';
            galleryStates.set(galleryId, 0);
            
            uaPopupContent += `<div class="popup-image-gallery" id="${galleryId}">`;
            uaImages.forEach((imgPath, index) => {
                uaPopupContent += `<img src="${imgPath}" class="${index === 0 ? 'active' : ''}" alt="Image ${index + 1}">`;
            });
            
            if (uaImages.length > 1) {
                uaPopupContent += `<div class="popup-gallery-controls">`;
                uaPopupContent += `<button class="popup-nav-btn" onclick="navigatePopupGallery('${galleryId}', -1)">← Prev</button>`;
                uaPopupContent += `<span class="popup-counter" id="${galleryId}-counter">1 / ${uaImages.length}</span>`;
                uaPopupContent += `<button class="popup-nav-btn" onclick="navigatePopupGallery('${galleryId}', 1)">Next →</button>`;
                uaPopupContent += `</div>`;
            }
            uaPopupContent += `</div>`;
        }
        
        const universityMarker = L.marker([51.2229654, 4.4102137], {icon: universityIcon})
            .addTo(map)
            .bindPopup(uaPopupContent, {
                closeOnClick: false,
                autoClose: false,
                closeButton: true
            });
        
        // Show popup on hover
        universityMarker.on('mouseover', function() {
            universityMarker.openPopup();
        });
        
        // Close popup when mouse leaves (with delay)
        universityMarker.on('mouseout', function() {
            setTimeout(function() {
                if (!isHoveringPopup && !pinnedMarkers.has(universityMarker)) {
                    universityMarker.closePopup();
                }
            }, 100);
        });
        
        // Pin on click
        universityMarker.on('click', function() {
            pinnedMarkers.add(universityMarker);
            universityMarker.openPopup();
            handleMarkerClick({
                name: 'University of Antwerp - Stadscampus',
                coordinates: [51.2229654, 4.4102137]
            }, universityMarker);
        });
        
        // Setup popup hover handling
        universityMarker.on('popupopen', function() {
            const popupElement = universityMarker.getPopup().getElement();
            
            popupElement.addEventListener('mouseenter', function() {
                isHoveringPopup = true;
            });
            
            popupElement.addEventListener('mouseleave', function() {
                isHoveringPopup = false;
                if (!pinnedMarkers.has(universityMarker)) {
                    universityMarker.closePopup();
                }
            });
            
            // Add double-click handler to images
            const images = popupElement.querySelectorAll('.popup-image-gallery img');
            images.forEach(function(img) {
                img.addEventListener('dblclick', function() {
                    window.open(img.src, '_blank');
                });
            });
        });
        
        // Unpin when popup closes
        universityMarker.on('popupclose', function() {
            pinnedMarkers.delete(universityMarker);
        });
        
        function closeAllPinnedPopups() {
            // Close all pinned popups and clear the set
            pinnedMarkers.forEach(function(marker) {
                marker.closePopup();
            });
            pinnedMarkers.clear();
        }
        
        function handleMarkerClick(location, marker) {
            if (selectedMarkers.length >= 2) {
                clearSelection();
            }
            
            selectedMarkers.push({
                location: location,
                marker: marker
            });
            
            // Highlight selected marker
            marker._icon.style.border = '3px solid yellow';
            marker._icon.style.width = '16px';
            marker._icon.style.height = '16px';
            
            if (selectedMarkers.length === 2) {
                calculateRoute();
            }
        }
        
        function calculateRoute() {
            if (selectedMarkers.length !== 2) return;
            
            // Close all pinned popups when showing a route
            closeAllPinnedPopups();
            
            const start = selectedMarkers[0].location.coordinates;
            const end = selectedMarkers[1].location.coordinates;
            
            // Remove existing route
            if (routingControl) {
                map.removeControl(routingControl);
            }
            
            // Add routing control for walking
            routingControl = L.Routing.control({
                waypoints: [
                    L.latLng(start[0], start[1]),
                    L.latLng(end[0], end[1])
                ],
                routeWhileDragging: false,
                addWaypoints: false,
                createMarker: function() { return null; }, // Don't create additional markers
                router: L.Routing.osrmv1({
                    serviceUrl: 'https://routing.openstreetmap.de/routed-foot/route/v1'
                }),
                lineOptions: {
                    styles: [{color: 'red', weight: 4, opacity: 0.7}]
                }
            }).on('routesfound', function(e) {
                const routes = e.routes;
                const summary = routes[0].summary;
                
                // Calculate walking time for faster walking speed (brisk pace: 6.0 km/h = 100 m/min)
                const walkingSpeedMetersPerMinute = 100;
                const walkingTimeMinutes = Math.ceil(summary.totalDistance / walkingSpeedMetersPerMinute);
                
                // Display travel information
                const travelInfo = document.getElementById('travelInfo');
                const travelDetails = document.getElementById('travelDetails');
                
                travelDetails.innerHTML = `
                    <strong>From:</strong> ${selectedMarkers[0].location.name}<br>
                    <strong>To:</strong> ${selectedMarkers[1].location.name}<br>
                    <strong>Distance:</strong> ${(summary.totalDistance / 1000).toFixed(2)} km<br>
                    <strong>Walking Time:</strong> ${walkingTimeMinutes} minutes<br>
                    <small>(brisk 6.0 km/h walking speed)</small>
                `;
                
                travelInfo.style.display = 'block';
            }).addTo(map);
        }
        
        function clearSelection() {
            // Reset marker styles
            selectedMarkers.forEach(function(item) {
                item.marker._icon.style.border = '2px solid white';
                item.marker._icon.style.width = '12px';
                item.marker._icon.style.height = '12px';
            });
            
            selectedMarkers = [];
            
            // Remove route
            if (routingControl) {
                map.removeControl(routingControl);
                routingControl = null;
            }
            
            // Hide travel info
            document.getElementById('travelInfo').style.display = 'none';
        }
        
        function navigatePopupGallery(galleryId, direction) {
            const gallery = document.getElementById(galleryId);
            if (!gallery) return;
            
            const images = gallery.querySelectorAll('img');
            const counter = document.getElementById(galleryId + '-counter');
            
            // Find current active image
            let currentIndex = 0;
            images.forEach((img, index) => {
                if (img.classList.contains('active')) {
                    currentIndex = index;
                    img.classList.remove('active');
                }
            });
            
            // Calculate new index
            currentIndex += direction;
            if (currentIndex < 0) currentIndex = images.length - 1;
            if (currentIndex >= images.length) currentIndex = 0;
            
            // Show new image
            images[currentIndex].classList.add('active');
            
            // Update counter
            if (counter) {
                counter.textContent = `${currentIndex + 1} / ${images.length}`;
            }
        }
    </script>
</body>
</html>
        